window.greenthumb=function(){"use strict";var a=angular.module("gtApp",["ngRoute","ui.bootstrap"]);return a.config(["$routeProvider",function(a){a.when("/",{templateUrl:"pages/home.html"}).when("/about/",{templateUrl:"pages/about.html"}).when("/contact/",{templateUrl:"pages/contact.html"}).when("/garden/:gardenID/",{templateUrl:"partials/garden.html"}).when("/garden/",{templateUrl:"partials/garden.html"}).otherwise({templateUrl:"pages/home.html"})}]),a}(),window.greenthumb.factory("gtGetData",function(a,t){var e={params:{dates:function(){var a=moment(),t={main:a.clone(),main_pos:Math.round(10*(8.333*(a.format("M")-1)+a.format("D")/a.daysInMonth()*8.333))/10,today:a,today_pos:Math.round(10*(8.333*(a.format("M")-1)+a.format("D")/a.daysInMonth()*8.333))/10};return t}()},model:[],gardens:[],activeGarden:{},produce:window.gtProduce};return e.create={garden:function(a){var t=this;return t.label=a.label,t.plantOnSat=a.options.plantOnSat,t.capHarvest=a.options.capHarvest,angular.isDefined(a.options.frost_spring)&&angular.isDefined(a.options.frost_spring.month)?(t.frost_spring={date:moment().set("month",a.options.frost_spring.month).set("date",a.options.frost_spring.date)},t.frost_spring.position=Math.floor(100*t.frost_spring.date.format("DDD")/365*10)/10):t.frost_spring=angular.isDefined(a.options.frost_spring)&&a.options.frost_spring===!1?"No Risk Of Frost":"Not Set",angular.isDefined(a.options.frost_fall)&&angular.isDefined(a.options.frost_fall.month)?(t.frost_fall={date:moment().set("month",a.options.frost_fall.month).set("date",a.options.frost_fall.date)},t.frost_fall.position=Math.floor(100*(365-t.frost_fall.date.format("DDD"))/365*10)/10):t.frost_fall=angular.isDefined(a.options.frost_fall)&&a.options.frost_fall===!1?"No Risk Of Frost":"Not Set",t.zone=a.options.zone||"Not Set",t.areas=[],t.tasks={},e.activeGarden=t,t.addArea=function(a){var n=new e.create.area(a);t.areas.push(n)},angular.isDefined(a.areas)&&a.areas.length>0&&angular.forEach(a.areas,function(a){t.addArea(a)}),t},area:function(a){var t=this;return t.label=a.label,t.width=a.width,t.length=a.length,t.produce=[],t.seasons={spring:!1,summmer:!1,fall:!1,winter:!1},t.addProduce=function(a){var n=new e.create.produce(a);t.produce.push(n),t.seasons[n.season]=!0},angular.isDefined(a.produce)&&a.produce.length>0&&angular.forEach(a.produce,function(a){t.addProduce(a)}),t},produce:function(a){var t=this;if("parent"in e.produce[a.id]){var n=e.produce[a.id].parent;angular.copy(e.produce[n],t),t=angular.extend(t,e.produce[a.id]),t.img=n,t.label_parent=e.produce[n].label,t.id_parent=n}else angular.copy(e.produce[a.id],t),t.img=a.id;t.id=a.id,t.seedling=parseInt(t.plantOutside)-parseInt(t.plantInside),t.label_short=t.label.charAt(0)+t.label.charAt(1),t.numPlants=a.numPlants;var r=moment().set("month",a.plantDate.month).set("date",a.plantDate.date);return e.activeGarden.plantOnSat===!0&&r.day("Saturday"),t.dates={seedlings:r.clone().subtract(t.seedling,"weeks"),plant:r,harvest_start:r.clone().add(t.maturity,"days"),harvest_complete:r.clone().add(7*t.harvest+t.maturity,"days")},t.dom={wSeedlings:Math.round(7*t.seedling*100/365*10)/10+1,wGrowing:Math.round(100*t.maturity/365*10)/10,wHarvesting:Math.round(7*t.harvest*100/365*10)/10+1,pSeedlings:Math.round(10*(8.333*(t.dates.seedlings.format("M")-1)+t.dates.seedlings.format("D")/t.dates.seedlings.daysInMonth()*8.333))/10,pGrowing:Math.round(10*(8.333*(t.dates.plant.format("M")-1)+t.dates.plant.format("D")/t.dates.plant.daysInMonth()*8.333))/10,pHarvesting:Math.round(10*(8.333*(t.dates.harvest_start.format("M")-1)+t.dates.harvest_start.format("D")/t.dates.harvest_start.daysInMonth()*8.333))/10-1},t.dates.plant.isBetween(moment().month("March").subtract(1,"month"),moment().month("May").date(31).add(1,"month"),"month")?t.season="spring":t.dates.plant.isBetween(moment().month("June").subtract(1,"month"),moment().month("August").date(31).add(1,"month"),"month")?t.season="summer":t.dates.plant.isBetween(moment().month("September").subtract(1,"month"),moment().month("November").date(30).add(1,"month"),"month")?t.season="fall":(t.dates.plant.isBetween(moment().month("November").subtract(1,"month"),moment().month("February").add(1,"month").add(1,"year"),"month")||t.dates.plant.isBetween(moment().month("January").subtract(1,"month"),moment().month("Feb").add(1,"month"),"month"))&&(t.season="winter"),t.plantInsideWarm=t.plantInside+4,t.plantOutsideWarm=t.plantOutside+4,e.create.tasks(t),t},tasks:function(a){angular.forEach(a.dates,function(t,n){var r;switch(n){case"seedlings":r="Start seedlings for ",a.directSow===!0&&(r="Direct sow "+a.plantCount+" "+a.label+" "+a.label_parent+" seeds");break;case"plant":r="Plant ";break;case"harvest_start":r="Start harvesting ";break;case"harvest_complete":r="Complete harvesting "}a.numPlants&&(r+=a.numPlants+" "),r+=a.label+" ",a.label_parent&&(r+=a.label_parent),angular.isObject(e.activeGarden.tasks[t.format("YYYYMMDD")])||(e.activeGarden.tasks[t.format("YYYYMMDD")]={label:t.format("dddd, MMMM Do"),items:[],date:t}),e.activeGarden.tasks[t.format("YYYYMMDD")].items.push(r)})}},e.load=function(n){console.log("data.load"),a({method:"GET",url:n}).then(function(a){e.model=a.data[0];var n=new e.create.garden(a.data[0]);e.gardens.push(n),t.$broadcast("dataPassed")})},e.update=function(a){angular.merge(e.params,a),e.params.dates.main_pos=Math.round(10*(8.333*(e.params.dates.main.format("M")-1)+e.params.dates.main.format("D")/e.params.dates.main.daysInMonth()*8.333))/10,t.$broadcast("dataPassed")},e}),window.greenthumb.factory("gtShared",function(){var a={params:{gardenID:!1,areaID:!1,produceID:!1}};return a.update=function(t){angular.merge(a.params,t)},console.log(a.params),a}),window.greenthumb.controller("gtGarden",function(a,t,e,n){a.Math=window.Math,a.gardenID=e.gardenID,a.taskpanel="next","mine"!==a.gardenID&&t.load("js/models/"+a.gardenID+".js"),a.addProduceStep1=function(a){n.areaID=a},a.gtDetails=function(t,e,r){var o={areaID:e,produceID:r};n.update(o),a.gtSelection=t},a.toggleTasks=function(t){a.taskpanel=t},a.$on("dataPassed",function(){console.log(t),a.garden=t.activeGarden.areas,a.label=t.activeGarden.label,a.frost_spring=t.activeGarden.frost_spring.position,a.frost_fall=t.activeGarden.frost_fall.position,a.main_pos=t.params.dates.main_pos,a.today_pos=t.params.dates.today_pos,a.tasksToday=[],a.tasksNext=[],a.tasksPrev=[],a.tasksToday.push(angular.isDefined(t.activeGarden.tasks[t.params.dates.main.format("YYYYMMDD")])?t.activeGarden.tasks[t.params.dates.main.format("YYYYMMDD")]:{label:t.params.dates.main.format("dddd, MMMM Do"),items:["Nothing for Today!"]}),angular.forEach(t.activeGarden.tasks,function(e){e.date.isBetween(t.params.dates.main.clone().add(1,"day"),t.params.dates.main.clone().add(1,"month"))?a.tasksNext.push(e):e.date.isBetween(t.params.dates.main.clone().subtract(1,"month"),t.params.dates.main)&&a.tasksPrev.push(e)})})}).directive("tasks",function(){return{restrict:"E",scope:{data:"="},templateUrl:"partials/tasks-entry.html"}}).directive("areas",function(){return{restrict:"E",scope:{data:"="},replace:!0,templateUrl:"partials/calendar-row.html"}}),window.greenthumb.controller("gtInteractive",function(a,t,e,n){a.addProduce={},a.error={date:!1},a.open=function(){a.status.opened=!0},a.status={opened:!1},a.options={};var r=[];angular.forEach(e.produce,function(a,t){var n={id:t,img:t,label:a.label};a.parent&&(n.img=a.parent,n.label=e.produce[a.parent].label+", "+n.label),r.push(n)}),a.produce=r,a.$watch("gtSearchTerm",function(){"undefined"!=typeof a.gtSearchTerm&&"undefined"!=typeof a.gtSearchTerm.id&&(a.error.plant=!1,a.addProduceStep2(a.gtSearchTerm.id))}),a.$watch("options.date",function(){a.error.date="undefined"!=typeof a.options.date&&""!==a.options.date&&null!==a.options.date?!0:!1}),a.deleteStep1=function(){console.log(n),$("#gtModalDetails").modal("hide"),$("#gtModalDelete").modal("show")},a.deleteStep2=function(){"produce"===n.params.type?e.activeGarden.areas[n.params.areaID].produce.splice(n.params.produceID,n.params.produceID+1):"area"===n.params.type&&e.activeGarden.areas.splice(n.params.areaID,n.params.areaID+1),t.$broadcast("dataPassed"),$("#gtModalDelete").modal("hide")},a.addArea=function(){var t={label:a.area.label,width:12,length:12};e.activeGarden.addArea(t)},a.addProduceStep2=function(t){a.addProduce.id=t;var n;e.produce[t].parent?(n=angular.copy(e.produce[e.produce[t].parent]),angular.merge(n,e.produce[t])):n=angular.copy(e.produce[t]),a.selection=n,a.dateRange={},moment.isMoment(e.activeGarden.frost_spring.date)?(a.dateRange.frost_spring=e.activeGarden.frost_spring.date.format("MMMM Do"),a.dateRange.warm_earliest=e.activeGarden.frost_spring.date.clone().add(n.plantOutside,"weeks").add(4,"weeks").format("MMMM Do"),a.dateRange.cold_earliest=e.activeGarden.frost_spring.date.clone().add(n.plantOutside,"weeks").format("MMMM Do")):a.dateRange.frost_spring="No Risk Of Frost"===e.activeGarden.frost_spring?"No Risk Of Frost":"Not Set",moment.isMoment(e.activeGarden.frost_fall.date)?(a.dateRange.frost_fall=e.activeGarden.frost_fall.date.format("MMMM Do"),a.dateRange.warm_latest=e.activeGarden.frost_fall.date.clone().subtract(n.maturity,"day").subtract(4,"weeks").format("MMMM Do"),a.dateRange.cold_latest=e.activeGarden.frost_fall.date.clone().subtract(n.maturity,"day").format("MMMM Do")):a.dateRange.frost_fall="No Risk Of Frost"===e.activeGarden.frost_fall?"No Risk Of Frost":"Not Set",moment.isMoment(e.activeGarden.frost_spring.date)&&moment.isMoment(e.activeGarden.frost_fall.date)&&(a.dateRange.growingseason=e.activeGarden.frost_fall.date.format("DDD")-e.activeGarden.frost_spring.date.format("DDD"))},a.addProduceStep3=function(){return a.error.date===!1?!1:(a.addProduce.plantDate={month:parseInt(moment(a.options.date).format("M")-1),date:parseInt(moment(a.options.date).format("D")-1)},e.activeGarden.areas[n.areaID].addProduce(a.addProduce),t.$broadcast("dataPassed"),$("#gtModalAdd").modal("hide"),a.addProduce={},a.gtSearchTerm="",void(a.selection={}))}}),window.greenthumb.controller("gtFilter",function(a,t){a.open=function(){a.status.opened=!0},a.status={opened:!1},a.date=new Date,a.filterSort=function(){var e={dates:{main:moment(a.date)}};t.update(e)}});